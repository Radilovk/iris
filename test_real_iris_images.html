<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test with Real Iris Images</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 1rem;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #60a5fa;
            margin-bottom: 2rem;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 1.5rem;
        }
        .test-section h2 {
            color: #60a5fa;
            margin-top: 0;
            font-size: 1.2rem;
        }
        .visual-composite {
            position: relative;
            width: 100%;
            padding-top: 100%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .visual-composite-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .iris-image {
            position: absolute;
            max-width: none;
            transform-origin: center center;
            will-change: transform;
        }
        .iris-overlay-svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(92%, 640px);
            height: min(92%, 640px);
            pointer-events: none;
            z-index: 10;
        }
        .overlay-ring {
            stroke: #ff00cc;
            stroke-width: 2;
            stroke-opacity: 0.4;
            fill: none;
        }
        .overlay-outer {
            stroke: #ff00cc;
            stroke-width: 4;
            fill: none;
        }
        .overlay-sector-line {
            stroke: #ff00cc;
            stroke-width: 1.2;
            stroke-opacity: 0.28;
        }
        .overlay-number {
            font: 700 32px/1 Arial, Helvetica, sans-serif;
            fill: #ff00cc;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        .overlay-center {
            fill: #ff00cc;
        }
        .method-label {
            text-align: center;
            padding: 0.5rem;
            background: #333;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .method-old {
            background: #dc2626;
        }
        .method-new {
            background: #10b981;
        }
        .info {
            background: #333;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-size: 0.85rem;
        }
        .info-label {
            color: #60a5fa;
            font-weight: 600;
        }
        .controls {
            margin: 1rem 0;
        }
        button {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            background: #60a5fa;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin: 0.25rem 0;
        }
        button:hover {
            background: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Test Overlay Alignment with Real Iris Images</h1>
        
        <div style="background: #2a2a2a; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
            <h2 style="color: #60a5fa; margin-top: 0;">About This Test</h2>
            <p>This page demonstrates the fix for topographic map overlay alignment. The left side shows the OLD (incorrect) method using a fixed radius, and the right side shows the NEW (correct) method using dynamic SVG sizing.</p>
            <p><strong>Test Images:</strong></p>
            <ul>
                <li>IMG_20251105_224415_edit_691479063092053.jpg (498√ó665px)</li>
                <li>IMG_20251105_224438_edit_691462468459039.jpg (492√ó656px)</li>
            </ul>
            <p><strong>Note:</strong> These alignment parameters are estimates. For accurate alignment, the AI vision model would detect the actual iris center and radius.</p>
        </div>

        <div class="comparison">
            <!-- OLD METHOD -->
            <div class="test-section">
                <div class="method-label method-old">‚ùå OLD METHOD (Fixed Radius)</div>
                <h2>Left Eye - Old Algorithm</h2>
                <div class="visual-composite">
                    <div class="visual-composite-inner">
                        <img id="iris-image-old-left" class="iris-image" src="res/IMG_20251105_224415_edit_691479063092053.jpg" alt="Left Iris">
                        <svg class="iris-overlay-svg" viewBox="-380 -380 760 760" xmlns="http://www.w3.org/2000/svg">
                            <circle r="112" class="overlay-ring"/>
                            <circle r="256" class="overlay-ring"/>
                            <g class="overlay-sector-lines">
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(0)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(30)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(60)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(90)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(120)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(150)"/>
                            </g>
                            <g class="overlay-numbers">
                                <text x="0" y="-372" class="overlay-number">12</text>
                                <text x="186" y="-322" class="overlay-number">1</text>
                                <text x="322" y="-186" class="overlay-number">2</text>
                                <text x="372" y="0" class="overlay-number">3</text>
                            </g>
                            <circle r="320" class="overlay-outer"/>
                            <circle r="8" class="overlay-center"/>
                        </svg>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="applyOldMethod('left')">Apply Old Method</button>
                </div>
                <div class="info" id="info-old-left"></div>
            </div>

            <!-- NEW METHOD -->
            <div class="test-section">
                <div class="method-label method-new">‚úÖ NEW METHOD (Dynamic Sizing)</div>
                <h2>Left Eye - New Algorithm</h2>
                <div class="visual-composite">
                    <div class="visual-composite-inner">
                        <img id="iris-image-new-left" class="iris-image" src="res/IMG_20251105_224415_edit_691479063092053.jpg" alt="Left Iris">
                        <svg class="iris-overlay-svg" viewBox="-380 -380 760 760" xmlns="http://www.w3.org/2000/svg">
                            <circle r="112" class="overlay-ring"/>
                            <circle r="256" class="overlay-ring"/>
                            <g class="overlay-sector-lines">
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(0)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(30)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(60)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(90)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(120)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(150)"/>
                            </g>
                            <g class="overlay-numbers">
                                <text x="0" y="-372" class="overlay-number">12</text>
                                <text x="186" y="-322" class="overlay-number">1</text>
                                <text x="322" y="-186" class="overlay-number">2</text>
                                <text x="372" y="0" class="overlay-number">3</text>
                            </g>
                            <circle r="320" class="overlay-outer"/>
                            <circle r="8" class="overlay-center"/>
                        </svg>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="applyNewMethod('left')">Apply New Method</button>
                </div>
                <div class="info" id="info-new-left"></div>
            </div>
        </div>

        <div class="comparison">
            <!-- OLD METHOD - RIGHT EYE -->
            <div class="test-section">
                <div class="method-label method-old">‚ùå OLD METHOD (Fixed Radius)</div>
                <h2>Right Eye - Old Algorithm</h2>
                <div class="visual-composite">
                    <div class="visual-composite-inner">
                        <img id="iris-image-old-right" class="iris-image" src="res/IMG_20251105_224438_edit_691462468459039.jpg" alt="Right Iris">
                        <svg class="iris-overlay-svg" viewBox="-380 -380 760 760" xmlns="http://www.w3.org/2000/svg">
                            <circle r="112" class="overlay-ring"/>
                            <circle r="256" class="overlay-ring"/>
                            <g class="overlay-sector-lines">
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(0)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(30)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(60)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(90)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(120)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(150)"/>
                            </g>
                            <g class="overlay-numbers">
                                <text x="0" y="-372" class="overlay-number">12</text>
                                <text x="186" y="-322" class="overlay-number">1</text>
                                <text x="322" y="-186" class="overlay-number">2</text>
                                <text x="372" y="0" class="overlay-number">3</text>
                            </g>
                            <circle r="320" class="overlay-outer"/>
                            <circle r="8" class="overlay-center"/>
                        </svg>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="applyOldMethod('right')">Apply Old Method</button>
                </div>
                <div class="info" id="info-old-right"></div>
            </div>

            <!-- NEW METHOD - RIGHT EYE -->
            <div class="test-section">
                <div class="method-label method-new">‚úÖ NEW METHOD (Dynamic Sizing)</div>
                <h2>Right Eye - New Algorithm</h2>
                <div class="visual-composite">
                    <div class="visual-composite-inner">
                        <img id="iris-image-new-right" class="iris-image" src="res/IMG_20251105_224438_edit_691462468459039.jpg" alt="Right Iris">
                        <svg class="iris-overlay-svg" viewBox="-380 -380 760 760" xmlns="http://www.w3.org/2000/svg">
                            <circle r="112" class="overlay-ring"/>
                            <circle r="256" class="overlay-ring"/>
                            <g class="overlay-sector-lines">
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(0)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(30)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(60)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(90)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(120)"/>
                                <line x1="0" y1="0" x2="0" y2="-348" class="overlay-sector-line" transform="rotate(150)"/>
                            </g>
                            <g class="overlay-numbers">
                                <text x="0" y="-372" class="overlay-number">12</text>
                                <text x="186" y="-322" class="overlay-number">1</text>
                                <text x="322" y="-186" class="overlay-number">2</text>
                                <text x="372" y="0" class="overlay-number">3</text>
                            </g>
                            <circle r="320" class="overlay-outer"/>
                            <circle r="8" class="overlay-center"/>
                        </svg>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="applyNewMethod('right')">Apply New Method</button>
                </div>
                <div class="info" id="info-new-right"></div>
            </div>
        </div>
    </div>

    <script>
        // Simulated alignment data for the test images
        // These would normally come from the AI vision model
        const alignmentData = {
            left: {
                center_x: 249,
                center_y: 332,
                radius_px: 180
            },
            right: {
                center_x: 246,
                center_y: 328,
                radius_px: 175
            }
        };

        function applyOldMethod(eye) {
            const img = document.getElementById(`iris-image-old-${eye}`);
            const container = img.parentElement;
            const alignment = alignmentData[eye];

            // OLD METHOD: Fixed targetRadius = 320
            const targetRadius = 320;
            const scale = targetRadius / alignment.radius_px;

            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            const translateX = containerWidth / 2 - alignment.center_x * scale;
            const translateY = containerHeight / 2 - alignment.center_y * scale;

            img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;

            document.getElementById(`info-old-${eye}`).innerHTML = `
                <div class="info-label">OLD METHOD (Fixed Radius):</div>
                <div>Fixed Target Radius: 320px</div>
                <div>Scale: ${scale.toFixed(3)}x</div>
                <div>Translation: (${translateX.toFixed(1)}, ${translateY.toFixed(1)})px</div>
                <div style="color: #dc2626; margin-top: 0.5rem;">
                    ‚ö†Ô∏è This method doesn't account for actual SVG size!
                </div>
            `;
        }

        function applyNewMethod(eye) {
            const img = document.getElementById(`iris-image-new-${eye}`);
            const container = img.parentElement;
            const alignment = alignmentData[eye];

            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            // NEW METHOD: Dynamic SVG sizing
            const svg = container.querySelector('.iris-overlay-svg');
            const svgRect = svg.getBoundingClientRect();
            const svgWidth = svgRect.width;
            const svgHeight = svgRect.height;

            const viewBoxRadius = 320;
            const viewBoxSize = 760;
            const actualSvgRadius = (Math.min(svgWidth, svgHeight) / viewBoxSize) * viewBoxRadius;

            const scale = actualSvgRadius / alignment.radius_px;

            const translateX = containerWidth / 2 - alignment.center_x * scale;
            const translateY = containerHeight / 2 - alignment.center_y * scale;

            img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;

            document.getElementById(`info-new-${eye}`).innerHTML = `
                <div class="info-label">NEW METHOD (Dynamic Sizing):</div>
                <div>SVG Actual Size: ${svgWidth.toFixed(1)}√ó${svgHeight.toFixed(1)}px</div>
                <div>Calculated Actual Radius: ${actualSvgRadius.toFixed(1)}px</div>
                <div>Scale: ${scale.toFixed(3)}x</div>
                <div>Translation: (${translateX.toFixed(1)}, ${translateY.toFixed(1)})px</div>
                <div style="color: #10b981; margin-top: 0.5rem;">
                    ‚úÖ This method uses actual SVG dimensions!
                </div>
            `;
        }

        // Auto-apply on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                applyOldMethod('left');
                applyNewMethod('left');
                applyOldMethod('right');
                applyNewMethod('right');
            }, 100);
        });
    </script>
</body>
</html>
