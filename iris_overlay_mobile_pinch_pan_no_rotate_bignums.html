<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Iris Overlay — Mobile (Pan/Zoom only)</title>
<style>
  :root{ --bg:#0f1214; --panel:#171b1f; --muted:#8a98a6; --text:#e8eef4; --mg:#FF00CC; }
  html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
  .app { display:flex; flex-direction:column; height:100%; }
  .stage-wrap { position:relative; flex:1; overflow:hidden; background:#000; touch-action:none; }
  .stage { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
  .photo { position:absolute; max-width:none; transform-origin:center center; will-change: transform; }
  .overlay-wrap { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
  .panel { background:var(--panel); padding:10px; border-top:1px solid #20262c; box-shadow:0 -8px 24px rgba(0,0,0,0.25); }
  .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  input[type="file"] { flex:1; color:var(--muted); }
  button { background:#222a31; color:var(--text); border:1px solid #2a333b; padding:8px 10px; border-radius:10px; font-weight:600; }
  button:active{ transform:scale(0.98); }
  .hint { font-size:12px; color:var(--muted); margin-top:6px; }
  /* Overlay styles (magenta biotech) */
  svg { display:block; }
  .thin { stroke: var(--mg); stroke-width:1.2; stroke-opacity:0.28; }
  .ring { stroke: var(--mg); stroke-width:2; stroke-opacity:0.40; }
  .outer { stroke: var(--mg); stroke-width:4.2; }
  .num  { font:700 32px/1 Arial,Helvetica,sans-serif; fill: var(--mg); } /* Increased font size */
  .glow { filter:url(#glow); }
</style>
</head>
<body>
<div class="app">
  <div class="stage-wrap" id="stageWrap">
    <div class="stage" id="stage">
      <!-- Photo underneath -->
      <img id="photo" class="photo" alt="photo" style="display:none;">

      <!-- Fixed overlay on top (transparent background) -->
      <div class="overlay-wrap">
        <div id="overlayBox" style="position:relative; width:min(92vh,92vw); height:min(92vh,92vw);">
          <svg id="overlay" viewBox="-380 -380 760 760" width="100%" height="100%" aria-label="Iris overlay">
            <defs>
              <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3.2" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>

            <!-- Faint guides for I and M (no labels) -->
            <circle r="112" class="ring" fill="none"/>
            <circle r="256" class="ring" fill="none"/>

            <!-- Ultra-faint half-hour radials -->
            <g id="radials" class="thin">
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(15)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(45)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(75)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(105)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(135)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(165)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(195)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(225)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(255)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(285)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(315)"/>
              <line x1="0" y1="0" x2="0" y2="-348" transform="rotate(345)"/>
            </g>

            <!-- Numbers outside (sector centers 0°,30°,...) -->
            <g id="numbers" class="num">
              <text x="0"    y="-372" text-anchor="middle" dominant-baseline="middle">12</text>
              <text x="186"  y="-322" text-anchor="middle" dominant-baseline="middle">1</text>
              <text x="322"  y="-186" text-anchor="middle" dominant-baseline="middle">2</text>
              <text x="372"  y="0"    text-anchor="middle" dominant-baseline="middle">3</text>
              <text x="322"  y="186"  text-anchor="middle" dominant-baseline="middle">4</text>
              <text x="186"  y="322"  text-anchor="middle" dominant-baseline="middle">5</text>
              <text x="0"    y="372"  text-anchor="middle" dominant-baseline="middle">6</text>
              <text x="-186" y="322"  text-anchor="middle" dominant-baseline="middle">7</text>
              <text x="-322" y="186"  text-anchor="middle" dominant-baseline="middle">8</text>
              <text x="-372" y="0"    text-anchor="middle" dominant-baseline="middle">9</text>
              <text x="-322" y="-186" text-anchor="middle" dominant-baseline="middle">10</text>
              <text x="-186" y="-322" text-anchor="middle" dominant-baseline="middle">11</text>
            </g>

            <!-- Prominent outer contour + center -->
            <circle r="320" class="outer glow" fill="none"/>
            <g class="glow"><circle r="8" fill="var(--mg)"/></g>
            <!-- fine crosshair -->
            <g class="thin" stroke-opacity="0.22">
              <line x1="-16" y1="0" x2="16" y2="0"/>
              <line x1="0" y1="-16" x2="0" y2="16"/>
            </g>

            <!-- Very faint snap ring -->
            <circle r="368" class="thin" stroke-opacity="0.10" fill="none"/>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <input id="file" type="file" accept="image/*">
      <button id="btnReset">Нулиране</button>
    </div>
    <div class="hint">С един пръст местиш снимката (ляво/дясно/нагоре/надолу). С два пръста приближаваш/отдалечаваш. Няма ротация.</div>
  </div>
</div>

<script>
(function(){
  const stageWrap = document.getElementById('stageWrap');
  const img = document.getElementById('photo');
  const file = document.getElementById('file');
  const btnReset = document.getElementById('btnReset');

  // Transform state (NO rotation)
  let state = {
    scale: 1,
    tx: 0,
    ty: 0,
    pointers: new Map(),
    startDist: 0,
    startScale: 1,
    startMid: {x:0,y:0},
    startTx: 0,
    startTy: 0,
    last: null
  };

  function applyTransform(){
    img.style.transform = `translate(${state.tx}px, ${state.ty}px) scale(${state.scale})`;
  }

  function reset(){
    state.scale = 1;
    state.tx = 0;
    state.ty = 0;
    applyTransform();
  }

  btnReset.addEventListener('click', reset);

  // Load file from gallery
  function loadFile(f){
    const url = URL.createObjectURL(f);
    img.onload = ()=>{
      img.style.display = 'block';
      reset();
    };
    img.src = url;
  }
  file.addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0]; if(!f) return;
    loadFile(f);
  });

  // Pointer events for pan (1 finger) / pinch-zoom (2 fingers), NO rotation
  stageWrap.addEventListener('pointerdown', (e)=>{
    if(img.style.display === 'none') return;
    img.setPointerCapture(e.pointerId);
    state.pointers.set(e.pointerId, {x:e.clientX, y:e.clientY});
    if(state.pointers.size===1){
      const p = state.pointers.values().next().value;
      state.last = {x:p.x, y:p.y};
    }
    if(state.pointers.size===2){
      const pts = Array.from(state.pointers.values());
      state.startDist = Math.hypot(pts[1].x-pts[0].x, pts[1].y-pts[0].y);
      state.startScale = state.scale;
      state.startMid = {x:(pts[0].x+pts[1].x)/2, y:(pts[0].y+pts[1].y)/2};
      state.startTx = state.tx;
      state.startTy = state.ty;
    }
  });
  stageWrap.addEventListener('pointermove', (e)=>{
    if(!state.pointers.has(e.pointerId)) return;
    state.pointers.set(e.pointerId, {x:e.clientX, y:e.clientY});
    if(state.pointers.size===1){
      const p = state.pointers.values().next().value;
      if(!state.last) state.last = {x:p.x, y:p.y};
      const dx = p.x - state.last.x;
      const dy = p.y - state.last.y;
      state.tx += dx;
      state.ty += dy;
      state.last = {x:p.x, y:p.y};
      applyTransform();
    }else if(state.pointers.size===2){
      const pts = Array.from(state.pointers.values());
      const dist = Math.hypot(pts[1].x-pts[0].x, pts[1].y-pts[0].y);
      if(state.startDist>0){
        const k = dist / state.startDist;
        state.scale = Math.min(5, Math.max(0.3, state.startScale * k));
        // keep midpoint stable (translation only; no rotation)
        const mid = { x:(pts[0].x+pts[1].x)/2, y:(pts[0].y+pts[1].y)/2 };
        state.tx = state.startTx + (mid.x - state.startMid.x);
        state.ty = state.startTy + (mid.y - state.startMid.y);
        applyTransform();
      }
    }
  });
  function endPointer(e){
    if(img.hasPointerCapture(e.pointerId)) img.releasePointerCapture(e.pointerId);
    state.pointers.delete(e.pointerId);
    if(state.pointers.size<2){ state.startDist=0; }
    if(state.pointers.size===0){ state.last=null; }
  }
  stageWrap.addEventListener('pointerup', endPointer);
  stageWrap.addEventListener('pointercancel', endPointer);
  stageWrap.addEventListener('pointerleave', (e)=>{ if(state.pointers.has(e.pointerId)) endPointer(e); });

})();
</script>
</body>
</html>