<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ирисологичен доклад</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <section class="analysis-section">
            <h2>Вашият анализ</h2>
            <div id="report-card" class="card"></div>
            <div id="message"></div>
            <div class="button-group" style="margin-top:2rem; text-align:center;">
                <a href="index.html" class="cta-button">Връщане към началната страница</a>
            </div>
        </section>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const card = document.getElementById('report-card');
        const message = document.getElementById('message');
        let data;
        try {
            const raw = localStorage.getItem('iridologyReport');
            if (!raw) throw new Error('Няма налични данни за анализ.');
            data = JSON.parse(raw);
        } catch (err) {
            card.style.display = 'none';
            message.textContent = 'Грешка: ' + err.message;
            message.className = 'error-box';
            return;
        }
        function renderValue(value, level = 3) {
            if (Array.isArray(value)) {
                const ul = document.createElement('ul');
                value.forEach(item => {
                    const li = document.createElement('li');
                    if (item && typeof item === 'object') {
                        li.appendChild(renderValue(item, level + 1));
                    } else {
                        li.textContent = String(item);
                    }
                    ul.appendChild(li);
                });
                return ul;
            } else if (value && typeof value === 'object') {
                const fragment = document.createDocumentFragment();
                Object.entries(value).forEach(([key, val]) => {
                    const section = document.createElement('div');
                    section.className = 'report-section';
                    if (key.toLowerCase().includes('disclaimer') || key.toLowerCase().includes('дисклеймер')) {
                        section.classList.add('disclaimer');
                    }
                    const heading = document.createElement('h' + Math.min(level, 6));
                    heading.textContent = key;
                    section.appendChild(heading);
                    section.appendChild(renderValue(val, Math.min(level + 1, 6)));
                    fragment.appendChild(section);
                });
                return fragment;
            } else {
                const p = document.createElement('p');
                p.textContent = String(value);
                return p;
            }
        }
        card.appendChild(renderValue(data));
    });
    </script>
</body>
</html>
