# Систематика на проекта Iris-Holistica AI

## 1. Обзор
Iris-Holistica AI е статичен фронтенд и Cloudflare Worker за холистичен анализ на ирисови изображения. Проектът комбинира форма за потребителски данни, административен панел за конфигурации и backend, който се свързва с AI модели и KV хранилище.

## 2. Статични страници
- **index.html** – начален екран с CTA бутон към формата за анализ и визуален хедър【F:index.html†L440-L451】.
- **analysis.html** – тристъпкова форма, събираща лични данни, навици и снимки на очите【F:analysis.html†L17-L33】.
- **admin.html** – панел за зареждане/запис на конфигурации, избор на модели и преглед на ключове в KV хранилището【F:admin.html†L16-L53】.
- **report.html** – страница за визуализация на генерирания доклад с персонализиран стил【F:report.html†L1-L59】.

## 3. Скриптове и Worker
- **script.js** – управлява стъпките на формата и изпраща `multipart/form-data` към Worker-а.
- **admin.js** – осигурява операции по зареждане, редактиране и запис на конфигурации и модели.
- **worker.js** – обработва POST заявки за анализ и проксира административните команди. Извлича контекст от KV, прави визуален анализ чрез Gemini или OpenAI и генерира финален JSON доклад.【F:worker.js†L1-L52】【F:worker.js†L157-L210】  
  Новата логика гарантира, че `{{EXTERNAL_CONTEXT}}` винаги получава сериализиран масив – при липса на уеб резултати се добавя синтезиран fallback с източник `LLM synthesis` и резюмета от холистичната база, за да не остава празен контекст.【F:worker.js†L371-L409】【F:worker.js†L430-L474】

## 4. KV хранилище
Основни ключове, зареждани при анализа【F:worker.js†L178-L180】: 
- `iris_config_kv` – активна конфигурация (модели, промптове). Пример: `provider: "openai", analysis_model: "gpt-4o"`【F:kv/iris_config_kv.json†L1-L6】.
- `iris_diagnostic_map` – топографска и конституционна база данни за ириса【F:kv/iris_diagnostic_map.txt†L1-L20】.
- `holistic_interpretation_knowledge` – алгоритъм за холистична интерпретация и приоритизиране на системи【F:kv/holistic_interpretation_knowledge.txt†L1-L16】.
- `remedy_and_recommendation_base` – универсални насоки и интервенции【F:kv/remedy_and_recommendation_base.txt†L1-L20】.
- `iris_models_list` – списък с налични модели по доставчик【F:kv/iris_models_list†L1】.

## 5. Папка `books`
Съдържа синтезирани учебници по иридология, използваеми за RAG (пример: `Practical Iridology.txt`)【F:books/Practical Iridology.txt†L1-L10】.

## 6. Тестове
Файлът `worker.test.js` валидира липсата на браузърни API, CORS хедърите и основните HTTP сценарии на Worker-а【F:worker.test.js†L1-L34】.

## 7. Идеи за оптимизация
1. **CORS** – задаване на конкретен домейн вместо `*` за по-висока сигурност.
2. **Кеширане на KV** – локално кеширане на конфигурациите в Worker-а за намаляване на latency.
3. **Разширени тестове** – добавяне на тестове за реален анализ с mock снимки и проверка на JSON доклада.
4. **Документация** – централизиране на промптовете и моделите в отделен модул за по-лесна поддръжка.

